<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Minhas Solicitações - CONDOMUS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --color-primary: #3c2b1c;
      --color-secondary: #6b512d;
      --color-accent: #d4a343;
      --color-text: #333;
      --color-light: #f8f9fa;
      --color-success: #198754;
      --color-warning: #ffc107;
      --color-danger: #dc3545;
      --sidebar-bg: #121212;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to right, var(--color-primary), var(--color-secondary));
      color: var(--color-text);
      transition: all 0.3s ease;
    }

    /* Dark Mode Variables */
    body.dark-mode {
      --color-primary: #121212;
      --color-secondary: #1f1f1f;
      --color-text: #e0e0e0;
      --sidebar-bg: #000;
      color-scheme: dark;
    }

    .sidebar {
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      width: 240px;
      background-color: var(--sidebar-bg);
      padding: 20px 0;
      color: white;
      text-align: center;
      display: flex;
      flex-direction: column;
      z-index: 100;
      transition: all 0.3s ease;
    }
    
    .sidebar img {
      width: 180px;
      height: 180px;
      object-fit: cover;
      border-radius: 50%;
      margin: 0 auto 10px;
      box-shadow: 0 0 15px rgba(212, 163, 67, 0.5);
      transition: all 0.3s ease;
    }
    
    .sidebar h4 {
      font-weight: bold;
      font-size: 1.2rem;
      color: var(--color-accent);
      margin-bottom: 20px;
    }
    
    .sidebar a {
      color: var(--color-accent);
      padding: 12px 25px;
      display: block;
      text-decoration: none;
      text-align: left;
      transition: all 0.3s ease;
      font-weight: 500;
    }
    
    .sidebar a.active {
      background-color: rgba(212, 163, 67, 0.2);
      border-left: 4px solid var(--color-accent);
      padding-left: 21px;
      color: #fff;
    }
    
    .sidebar a:hover {
      background-color: rgba(212, 163, 67, 0.1);
      color: #f0c96b;
    }
    
    .sidebar a i {
      margin-right: 10px;
    }
    
    .sidebar hr {
      border-color: #333;
      width: 80%;
      margin: 10px auto;
    }

    .content {
      margin-left: 250px;
      padding: 2rem;
      transition: all 0.3s ease;
      background-color: var(--color-secondary);
      min-height: 100vh;
    }

    .dark-mode .content {
      background-color: var(--color-secondary);
    }

    .titulo-dourado {
      color: var(--color-accent);
    }

    .card-solicitacao {
      background: #fff;
      border-radius: 12px;
      padding: 1rem 1.5rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      transition: all 0.3s ease;
      margin-bottom: 1rem;
    }

    .dark-mode .card-solicitacao {
      background-color: #2a2a2a;
      color: var(--color-text);
    }

    .card-solicitacao:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }

    .status-aprovado { border-left: 5px solid var(--color-success); }
    .status-pendente { border-left: 5px solid var(--color-warning); }
    .status-recusado { border-left: 5px solid var(--color-danger); }

    .dark-mode .form-select,
    .dark-mode .form-control {
      background-color: #333;
      color: var(--color-text);
      border-color: #444;
    }

    .dark-mode .modal-content {
      background-color: #2a2a2a;
      color: var(--color-text);
    }

    .dark-mode .toast {
      background-color: #333;
    }

    /* Botões e elementos interativos */
    .btn-nova-solicitacao {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 999;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .btn-nova-solicitacao:hover {
      transform: scale(1.05) translateY(-3px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    }

    .dark-toggle-btn {
      position: fixed;
      top: 15px;
      right: 15px;
      background: var(--color-primary);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-accent);
      font-size: 1.5rem;
      z-index: 1000;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .dark-toggle-btn:hover {
      transform: rotate(30deg) scale(1.1);
    }

    /* Cards de prestadores */
    .card-prestador {
      background: #fff;
      border-radius: 10px;
      margin-bottom: 15px;
      transition: all 0.3s ease;
      padding: 1rem;
    }

    .dark-mode .card-prestador {
      background-color: #333;
    }

    .card-prestador:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }

    .prestador-img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 50%;
      border: 3px solid var(--color-accent);
    }

    .prestador-img-lg {
      width: 150px;
      height: 150px;
      border-width: 5px;
    }

    .rating-stars {
      color: var(--color-warning);
      font-size: 0.9rem;
    }

    /* Toast notifications */
    .toast-container {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 1100;
    }

    /* Loading spinner */
    .spinner-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }

    .spinner-container.active {
      display: flex;
    }

    /* Responsividade */
    @media (max-width: 992px) {
      .sidebar {
        width: 70px;
        overflow: hidden;
      }
      
      .sidebar img {
        width: 50px;
        height: 50px;
      }
      
      .sidebar h4, .sidebar a span {
        display: none;
      }
      
      .sidebar a {
        text-align: center;
        padding: 12px 5px;
      }
      
      .sidebar a i {
        margin-right: 0;
        font-size: 1.2rem;
      }
      
      .content {
        margin-left: 70px;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        height: auto;
        position: relative;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .sidebar a {
        display: inline-block;
        width: auto;
        padding: 10px 15px;
      }
      
      .content {
        margin-left: 0;
      }
      
      .modal-dialog {
        margin: 0.5rem;
        width: auto;
      }
    }

    @media (max-width: 576px) {
      .modal-dialog {
        margin: 0;
        width: 100%;
        max-width: none;
        height: 100vh;
      }
      
      .modal-content {
        border-radius: 0;
        height: 100%;
      }
      
      .btn-nova-solicitacao {
        bottom: 10px;
        right: 10px;
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
<!-- Spinner de Loading -->
<div class="spinner-container" id="loadingSpinner">
  <div class="spinner-border text-warning" style="width: 3rem; height: 3rem;" role="status">
    <span class="visually-hidden">Carregando...</span>
  </div>
</div>

<!-- Toast Notifications -->
<div class="toast-container">
  <div class="toast align-items-center text-white bg-success" id="toastSuccess" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
        <i class="bi bi-check-circle-fill me-2"></i>
        <span id="toastSuccessMessage">Operação realizada com sucesso!</span>
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
  
  <div class="toast align-items-center text-white bg-danger" id="toastError" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <span id="toastErrorMessage">Ocorreu um erro!</span>
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>

<!-- Botão de modo escuro -->
<button class="dark-toggle-btn" onclick="toggleDarkMode()" title="Alternar modo escuro" aria-label="Alternar modo escuro">
  <i class="bi bi-moon-stars-fill" id="darkModeIcon"></i>
</button>

<!-- Sidebar -->
<nav class="sidebar">
    <img src="img/logo.png" alt="Logo CONDOMUS">
    <h4><i class="bi bi-house-door-fill me-1"></i>CONDOMUS</h4>

    <hr>
    <a href="dashboard_morador.html"><i class="bi bi-grid-fill me-2"></i> Início</a>
    <a href="prestadores.html"><i class="bi bi-person-lines-fill me-2"></i> Prestadores</a>
    <a href="minhas_solicitacoes.html"><i class="bi bi-clipboard-check me-2"></i> Minhas solicitações</a>
    <a href="minhas_avaliacoes.html"><i class="bi bi-star-fill me-2"></i> Minhas avaliações</a>
    <a href="favoritos.html"><i class="bi bi-heart-fill me-2"></i> Meus favoritos</a>
    <a href="ranking.html"><i class="bi bi-trophy me-2"></i> Ranking de prestadores</a>
    <hr>
    <a href="minha_conta.html"><i class="bi bi-person-circle me-2"></i> Minha conta</a>
    <a href="index.html" style="margin-bottom: 0px; margin-top: 0px;">
      <i class="bi bi-box-arrow-right me-2"></i> Sair
    </a>
  </nav>

<!-- Conteúdo -->
<div class="content">
  <h2 class="text-center fw-bold mb-4 titulo-dourado">Minhas Solicitações</h2>

  <div class="mb-4 text-center">
    <select class="form-select w-auto d-inline-block" id="filtroStatus" onchange="SolicitacaoManager.filtrar()" aria-label="Filtrar por status">
      <option value="todos">Todas</option>
      <option value="pendente">Pendentes (<span id="count-pendente">0</span>)</option>
      <option value="aprovado">Aprovadas (<span id="count-aprovado">0</span>)</option>
      <option value="recusado">Recusadas (<span id="count-recusado">0</span>)</option>
    </select>
  </div>

  <div class="row g-3" id="listaSolicitacoes">
    <!-- As solicitações serão carregadas dinamicamente via JavaScript -->
  </div>
</div>

<!-- Botão flutuante para nova solicitação -->
<button class="btn btn-warning btn-nova-solicitacao rounded-pill fw-bold shadow" data-bs-toggle="modal" data-bs-target="#novaSolicitacaoModal" aria-label="Nova solicitação">
  <i class="bi bi-plus-circle"></i> <span class="d-none d-md-inline">Nova Solicitação</span>
</button>

<!-- Modal Nova Solicitação -->
<div class="modal fade" id="novaSolicitacaoModal" tabindex="-1" aria-labelledby="novaSolicitacaoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content border-0">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title fw-bold" id="novaSolicitacaoModalLabel"><i class="bi bi-plus-circle me-2"></i>Nova Solicitação de Serviço</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>

      <div class="modal-body">
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="filtroNicho" class="form-label fw-semibold">Escolha o nicho desejado:</label>
            <select class="form-select" id="filtroNicho" onchange="PrestadorUI.filtrarPorNicho()" aria-label="Filtrar por nicho">
              <option value="Todos">Todos</option>
              <option>Serviços de Elétrica</option>
              <option>Jardinagem</option>
              <option>Serviços de Pintura</option>
              <option>Serviços de Vidros e Espelhos</option>
              <option>Montagem de Móveis</option>
              <option>Outros</option>
            </select>
          </div>
          <div class="col-md-6">
            <label for="buscaPrestador" class="form-label fw-semibold">Buscar prestador:</label>
            <input type="text" class="form-control" id="buscaPrestador" placeholder="Digite o nome do prestador..." onkeyup="PrestadorUI.filtrarPorNome()" aria-label="Buscar prestador por nome">
          </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-3">
          <h6 class="mb-0 fw-bold">Prestadores disponíveis</h6>
          <div>
            <span id="contadorPrestadores">0</span> prestadores encontrados
          </div>
        </div>

        <div class="row" id="listaPrestadoresNicho">
          <!-- Os prestadores serão carregados dinamicamente via JavaScript -->
        </div>

        <nav aria-label="Navegação de prestadores" class="mt-3">
          <ul class="pagination justify-content-center" id="paginacaoPrestadores">
            <!-- A paginação será gerada dinamicamente via JavaScript -->
          </ul>
        </nav>
      </div>

      <div class="modal-footer border-0">
        <button class="btn btn-secondary" data-bs-dismiss="modal"><i class="bi bi-x-circle"></i> Fechar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Detalhes da Solicitação -->
<div class="modal fade" id="modalDetalhesSolicitacao" tabindex="-1" aria-labelledby="modalDetalhesSolicitacaoLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title fw-bold" id="modalDetalhesSolicitacaoLabel"><i class="bi bi-info-circle me-2"></i>Detalhes da Solicitação</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <p><strong>Serviço:</strong> <span id="tituloModal"></span></p>
        <p><strong>Descrição:</strong> <span id="descricaoModal"></span></p>
        <p><strong>Data:</strong> <span id="dataModal"></span></p>
        <p><strong>Status:</strong> <span id="statusModal"></span></p>
        <hr>
        <p><strong>Prestador:</strong> <span id="prestadorModal"></span></p>
        <p><strong>Telefone:</strong> <span id="telefoneModal"></span></p>
        <p><strong>E-mail:</strong> <span id="emailModal"></span></p>
        <button class="btn btn-outline-primary btn-sm mt-2" onclick="UI.abrirModalPrestadorDoDetalhe()" aria-label="Ver perfil do prestador">
          <i class="bi bi-person-lines-fill"></i> Ver perfil do prestador
        </button>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="bi bi-x-circle"></i> Fechar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Perfil do Prestador -->
<div class="modal fade" id="modalPerfilPrestador" tabindex="-1" aria-labelledby="modalPerfilPrestadorLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title fw-bold" id="modalPerfilPrestadorLabel"><i class="bi bi-person-badge me-2"></i>Perfil do Prestador</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-4 text-center">
            <img id="prestadorFoto" src="" alt="Foto do prestador" class="img-fluid rounded-circle mb-3 prestador-img-lg">
            <h4 id="prestadorNome" class="fw-bold mb-1"></h4>
            <span id="prestadorStatus" class="badge bg-success mb-3"></span>
            <div class="rating-stars mb-3" id="prestadorRating"></div>
            <button class="btn btn-warning w-100 mb-2" onclick="SolicitacaoManager.iniciarSolicitacaoDoModal()" aria-label="Solicitar serviço">
              <i class="bi bi-send"></i> Solicitar Serviço
            </button>
            <button class="btn btn-outline-secondary w-100" data-bs-dismiss="modal" aria-label="Fechar">
              <i class="bi bi-x-circle"></i> Fechar
            </button>
          </div>
          <div class="col-md-8">
            <div class="mb-4">
              <h5 class="fw-bold"><i class="bi bi-info-circle"></i> Informações</h5>
              <p><strong>Nicho:</strong> <span id="prestadorNicho"></span></p>
              <p><strong>Telefone:</strong> <span id="prestadorTelefone"></span></p>
              <p><strong>E-mail:</strong> <span id="prestadorEmail"></span></p>
              <p><strong>Avaliações:</strong> <span id="prestadorAvaliacoes"></span> avaliações</p>
            </div>
            <div>
              <h5 class="fw-bold"><i class="bi bi-star-fill"></i> Sobre</h5>
              <p id="prestadorSobre"></p>
            </div>
            <div class="mt-4">
              <h5 class="fw-bold"><i class="bi bi-chat-left-text"></i> Últimas Avaliações</h5>
              <div id="avaliacoesPrestador" class="mt-2">
                <!-- As avaliações serão carregadas dinamicamente -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Solicitar Serviço -->
<div class="modal fade" id="modalSolicitarServico" tabindex="-1" aria-labelledby="modalSolicitarServicoLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title fw-bold" id="modalSolicitarServicoLabel"><i class="bi bi-send me-2"></i>Solicitar Serviço</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <p>Você está solicitando um serviço para:</p>
        <div class="d-flex align-items-center mb-4">
          <img id="solicitarFoto" src="img/perfil-padrao.jpg" alt="Foto do prestador" class="rounded-circle me-3 prestador-img">
          <div>
            <h6 id="solicitarNome" class="mb-0 fw-bold"></h6>
            <small id="solicitarNicho" class="text-muted"></small>
          </div>
        </div>
        <form id="formSolicitacao">
          <div class="mb-3">
            <label for="tipoServico" class="form-label">Tipo de Serviço *</label>
            <input type="text" class="form-control" id="tipoServico" required aria-required="true">
          </div>
          <div class="mb-3">
            <label for="descricaoServico" class="form-label">Descrição Detalhada *</label>
            <textarea class="form-control" id="descricaoServico" rows="3" required aria-required="true"></textarea>
            <div class="form-text">Descreva com detalhes o serviço que precisa</div>
          </div>
          <div class="mb-3">
            <label for="dataServico" class="form-label">Data Preferencial *</label>
            <input type="date" class="form-control" id="dataServico" required aria-required="true">
          </div>
          <div class="mb-3">
            <label for="anexoServico" class="form-label">Anexos (Opcional)</label>
            <input type="file" class="form-control" id="anexoServico" multiple>
            <div class="form-text">Você pode anexar fotos ou documentos relacionados</div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="bi bi-x-circle"></i> Cancelar</button>
        <button type="button" class="btn btn-warning" id="btnEnviarSolicitacao" onclick="SolicitacaoManager.enviar()">
          <i class="bi bi-send"></i> Enviar Solicitação
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  /**
   * Módulo principal de UI/UX
   */
  const UI = {
    // Elementos do DOM
    elements: {
      loadingSpinner: document.getElementById('loadingSpinner'),
      toastSuccess: new bootstrap.Toast(document.getElementById('toastSuccess')),
      toastError: new bootstrap.Toast(document.getElementById('toastError')),
      toastSuccessMessage: document.getElementById('toastSuccessMessage'),
      toastErrorMessage: document.getElementById('toastErrorMessage'),
      darkModeIcon: document.getElementById('darkModeIcon'),
      body: document.body
    },
    
    // Mostrar loading spinner
    showLoading: function() {
      this.elements.loadingSpinner.classList.add('active');
    },
    
    // Esconder loading spinner
    hideLoading: function() {
      this.elements.loadingSpinner.classList.remove('active');
    },
    
    // Mostrar toast de sucesso
    showSuccessToast: function(message) {
      this.elements.toastSuccessMessage.textContent = message;
      this.elements.toastSuccess.show();
    },
    
    // Mostrar toast de erro
    showErrorToast: function(message) {
      this.elements.toastErrorMessage.textContent = message;
      this.elements.toastError.show();
    },
    
    // Alternar modo escuro/claro
    toggleDarkMode: function() {
      this.elements.body.classList.toggle('dark-mode');
      const isDark = this.elements.body.classList.contains('dark-mode');
      localStorage.setItem('modoEscuro', isDark);
      
      // Alternar ícone
      if (isDark) {
        this.elements.darkModeIcon.classList.remove('bi-moon-stars-fill');
        this.elements.darkModeIcon.classList.add('bi-sun-fill');
      } else {
        this.elements.darkModeIcon.classList.remove('bi-sun-fill');
        this.elements.darkModeIcon.classList.add('bi-moon-stars-fill');
      }
    },
    
    // Verificar e aplicar modo escuro ao carregar
    checkDarkMode: function() {
      const darkMode = localStorage.getItem('modoEscuro') === 'true';
      if (darkMode) {
        this.elements.body.classList.add('dark-mode');
        this.elements.darkModeIcon.classList.remove('bi-moon-stars-fill');
        this.elements.darkModeIcon.classList.add('bi-sun-fill');
      }
    },
    
    // Abrir modal de prestador a partir do modal de detalhes
    abrirModalPrestadorDoDetalhe: function() {
      const modalDetalhes = bootstrap.Modal.getInstance(document.getElementById('modalDetalhesSolicitacao'));
      modalDetalhes.hide();
      
      // Simular dados do prestador (em uma aplicação real, buscaria do servidor)
      PrestadorUI.mostrar({
        nome: solicitacaoAtual.nome,
        nicho: "Nicho não especificado",
        foto: "img/perfil-padrao.jpg",
        telefone: solicitacaoAtual.telefone,
        email: solicitacaoAtual.email,
        rating: "4.0",
        avaliacoes: "10",
        status: "Status desconhecido",
        sobre: "Informações não disponíveis"
      });
    },
    
    // Inicializar
    init: function() {
      this.checkDarkMode();
    }
  };

  /**
   * Módulo de gerenciamento de solicitações
   */
  const SolicitacaoManager = {
    // Dados temporários (em produção, viriam de uma API)
    solicitacoes: [
      {
        id: 1,
        titulo: "Instalação de Rede",
        descricao: "Instalação de rede no bloco A",
        data: "01/07/2025",
        status: "aprovado",
        prestador: "Carlos Redes LTDA",
        telefone: "(11) 99999-1234",
        email: "carlos@redes.com"
      },
      {
        id: 2,
        titulo: "Reparo Elétrico",
        descricao: "Queda de energia na garagem",
        data: "28/06/2025",
        status: "pendente",
        prestador: "EletroFix Serviços",
        telefone: "(11) 91234-5678",
        email: "contato@eletrofix.com"
      },
      {
        id: 3,
        titulo: "Jardinagem",
        descricao: "Poda de arbustos da entrada principal",
        data: "22/06/2025",
        status: "recusado",
        prestador: "Flor & Verde Paisagismo",
        telefone: "(11) 98888-7777",
        email: "florverde@email.com"
      }
    ],
    
    prestadorAtual: null,
    solicitacaoAtual: null,
    
    // Carregar solicitações
    carregar: function() {
      UI.showLoading();
      
      // Simular requisição assíncrona
      setTimeout(() => {
        this.renderizarLista();
        this.atualizarContadores();
        UI.hideLoading();
      }, 800);
    },
    
    // Renderizar lista de solicitações
    renderizarLista: function() {
      const container = document.getElementById('listaSolicitacoes');
      container.innerHTML = '';
      
      this.solicitacoes.forEach(solicitacao => {
        const statusClass = `status-${solicitacao.status}`;
        let statusBadge = '';
        
        if (solicitacao.status === 'aprovado') {
          statusBadge = '<span class="text-success fw-bold">✔ Aprovado</span>';
        } else if (solicitacao.status === 'pendente') {
          statusBadge = '<span class="text-warning fw-bold">⏳ Pendente</span>';
        } else {
          statusBadge = '<span class="text-danger fw-bold">✖ Recusado</span>';
        }
        
        const cardHTML = `
          <div class="col-12 col-md-6 solicitacao ${statusClass}">
            <div class="card-solicitacao">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h5>${solicitacao.titulo}</h5>
                  <small>Solicitado em: ${solicitacao.data}</small><br>
                  ${statusBadge}
                </div>
                <button class="btn btn-outline-secondary btn-sm" 
                  onclick="SolicitacaoManager.abrirDetalhes(${solicitacao.id})"
                  aria-label="Ver detalhes da solicitação ${solicitacao.titulo}">
                  Detalhes
                </button>
              </div>
            </div>
          </div>
        `;
        
        container.insertAdjacentHTML('beforeend', cardHTML);
      });
    },
    
    // Filtrar solicitações por status
    filtrar: function() {
      const filtro = document.getElementById('filtroStatus').value;
      const cards = document.querySelectorAll('.solicitacao');
      
      cards.forEach(card => {
        card.style.display = filtro === 'todos' || card.classList.contains(`status-${filtro}`) ? 'block' : 'none';
      });
    },
    
    // Atualizar contadores de status
    atualizarContadores: function() {
      const counts = { aprovado: 0, pendente: 0, recusado: 0 };
      
      this.solicitacoes.forEach(solicitacao => {
        counts[solicitacao.status]++;
      });
      
      document.getElementById('count-aprovado').textContent = counts.aprovado;
      document.getElementById('count-pendente').textContent = counts.pendente;
      document.getElementById('count-recusado').textContent = counts.recusado;
    },
    
    // Abrir modal com detalhes da solicitação
    abrirDetalhes: function(id) {
      const solicitacao = this.solicitacoes.find(s => s.id === id);
      
      if (!solicitacao) {
        UI.showErrorToast('Solicitação não encontrada');
        return;
      }
      
      document.getElementById('tituloModal').textContent = solicitacao.titulo;
      document.getElementById('descricaoModal').textContent = solicitacao.descricao;
      document.getElementById('dataModal').textContent = solicitacao.data;
      
      let statusText = '';
      if (solicitacao.status === 'aprovado') {
        statusText = '✔ Aprovado';
      } else if (solicitacao.status === 'pendente') {
        statusText = '⏳ Pendente';
      } else {
        statusText = '✖ Recusado';
      }
      
      document.getElementById('statusModal').textContent = statusText;
      document.getElementById('prestadorModal').textContent = solicitacao.prestador;
      document.getElementById('telefoneModal').textContent = solicitacao.telefone;
      document.getElementById('emailModal').textContent = solicitacao.email;
      
      // Armazenar dados para uso posterior
      this.solicitacaoAtual = {
        nome: solicitacao.prestador,
        telefone: solicitacao.telefone,
        email: solicitacao.email
      };
      
      const modal = new bootstrap.Modal(document.getElementById('modalDetalhesSolicitacao'));
      modal.show();
    },
    
    // Iniciar nova solicitação a partir do modal de prestador
    iniciarSolicitacaoDoModal: function() {
      if (!this.prestadorAtual) {
        UI.showErrorToast('Nenhum prestador selecionado');
        return;
      }
      
      // Fechar modal do prestador
      const modalPrestador = bootstrap.Modal.getInstance(document.getElementById('modalPerfilPrestador'));
      modalPrestador.hide();
      
      // Preencher dados no modal de solicitação
      document.getElementById('solicitarNome').textContent = this.prestadorAtual.nome;
      document.getElementById('solicitarNicho').textContent = this.prestadorAtual.nicho;
      document.getElementById('solicitarFoto').src = this.prestadorAtual.foto;
      
      // Limpar formulário
      document.getElementById('formSolicitacao').reset();
      
      // Mostrar modal de solicitação
      const modal = new bootstrap.Modal(document.getElementById('modalSolicitarServico'));
      modal.show();
    },
    
    // Enviar nova solicitação
    enviar: function() {
      const tipoServico = document.getElementById('tipoServico').value;
      const descricao = document.getElementById('descricaoServico').value;
      const data = document.getElementById('dataServico').value;
      
      if (!tipoServico || !descricao || !data) {
        UI.showErrorToast('Por favor, preencha todos os campos obrigatórios');
        return;
      }
      
      // Validar data
      const dataObj = new Date(data);
      if (dataObj < new Date()) {
        UI.showErrorToast('A data deve ser futura');
        return;
      }
      
      // Mostrar loading
      const submitBtn = document.getElementById('btnEnviarSolicitacao');
      submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span> Enviando...';
      submitBtn.disabled = true;
      
      // Simular envio assíncrono
      setTimeout(() => {
        // Criar nova solicitação
        const novaSolicitacao = {
          id: Date.now(),
          titulo: tipoServico,
          descricao: descricao,
          data: new Date(data).toLocaleDateString('pt-BR'),
          status: 'pendente',
          prestador: this.prestadorAtual.nome,
          telefone: this.prestadorAtual.telefone || 'Não informado',
          email: this.prestadorAtual.email || 'Não informado'
        };
        
        // Adicionar à lista (em produção, seria uma chamada API)
        this.solicitacoes.unshift(novaSolicitacao);
        
        // Atualizar UI
        this.renderizarLista();
        this.atualizarContadores();
        
        // Fechar modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('modalSolicitarServico'));
        modal.hide();
        
        // Resetar botão
        submitBtn.innerHTML = '<i class="bi bi-send"></i> Enviar Solicitação';
        submitBtn.disabled = false;
        
        // Mostrar feedback
        UI.showSuccessToast('Solicitação enviada com sucesso!');
      }, 1500);
    },
    
    // Inicializar
    init: function() {
      this.prestadorAtual = null;
      this.solicitacaoAtual = null;
      this.carregar();
    }
  };

  /**
   * Módulo de UI para prestadores
   */
  const PrestadorUI = {
    // Dados temporários (em produção, viriam de uma API)
    prestadores: [
      {
        id: 1,
        nome: "José Silva",
        nicho: "Serviços de Elétrica",
        foto: "img/perfil1.jpg",
        telefone: "(11) 98765-4321",
        email: "jose.silva@email.com",
        rating: 4.5,
        avaliacoes: 23,
        status: "Online",
        sobre: "Eletricista com 15 anos de experiência, especializado em instalações residenciais e comerciais. Trabalho com garantia e materiais de primeira linha."
      },
      {
        id: 2,
        nome: "Maria Jardim",
        nicho: "Jardinagem",
        foto: "img/perfil2.jpg",
        telefone: "(11) 91234-5678",
        email: "maria.jardim@email.com",
        rating: 4.0,
        avaliacoes: 15,
        status: "Offline",
        sobre: "Jardineira profissional com formação em paisagismo. Ofereço serviços de poda, plantio, manutenção de jardins e projetos paisagísticos."
      },
      {
        id: 3,
        nome: "Carlos Pintura",
        nicho: "Serviços de Pintura",
        foto: "img/perfil3.jpg",
        telefone: "(11) 94567-8901",
        email: "carlos.pintura@email.com",
        rating: 4.7,
        avaliacoes: 42,
        status: "Online",
        sobre: "Pintor profissional com experiência em residências, apartamentos e estabelecimentos comerciais. Trabalho com as melhores tintas do mercado."
      },
      {
        id: 4,
        nome: "Ana Vidraçaria",
        nicho: "Serviços de Vidros e Espelhos",
        foto: "img/perfil4.jpg",
        telefone: "(11) 92345-6789",
        email: "ana.vidros@email.com",
        rating: 4.2,
        avaliacoes: 18,
        status: "Online",
        sobre: "Especialista em instalação e reparo de vidros e espelhos. Atendo residências e empresas com orçamento sem compromisso."
      },
      {
        id: 5,
        nome: "Marcos Montador",
        nicho: "Montagem de Móveis",
        foto: "img/perfil5.jpg",
        telefone: "(11) 93456-7890",
        email: "marcos.montador@email.com",
        rating: 4.8,
        avaliacoes: 37,
        status: "Offline",
        sobre: "Profissional especializado em montagem de móveis, armários, estantes e outros itens. Trabalho rápido e com cuidado com seus pertences."
      },
      {
        id: 6,
        nome: "Luiza Serviços Gerais",
        nicho: "Outros",
        foto: "img/perfil6.jpg",
        telefone: "(11) 95678-9012",
        email: "luiza.servicos@email.com",
        rating: 4.3,
        avaliacoes: 29,
        status: "Online",
        sobre: "Ofereço diversos serviços gerais para residências e empresas. Limpeza, organização, pequenos reparos e muito mais."
      }
    ],
    
    // Configuração de paginação
    paginacao: {
      paginaAtual: 1,
      itensPorPagina: 4,
      totalPaginas: 1
    },
    
    // Filtrar prestadores por nicho
    filtrarPorNicho: function() {
      const filtro = document.getElementById('filtroNicho').value.toLowerCase();
      const busca = document.getElementById('buscaPrestador').value.toLowerCase();
      
      this.paginacao.paginaAtual = 1;
      this.renderizarLista(filtro, busca);
    },
    
    // Filtrar prestadores por nome
    filtrarPorNome: function() {
      const filtro = document.getElementById('filtroNicho').value.toLowerCase();
      const busca = document.getElementById('buscaPrestador').value.toLowerCase();
      
      this.paginacao.paginaAtual = 1;
      this.renderizarLista(filtro, busca);
    },
    
    // Renderizar lista de prestadores com paginação
    renderizarLista: function(filtroNicho = 'todos', filtroNome = '') {
      const container = document.getElementById('listaPrestadoresNicho');
      const paginacaoContainer = document.getElementById('paginacaoPrestadores');
      
      container.innerHTML = '';
      paginacaoContainer.innerHTML = '';
      
      // Filtrar prestadores
      let prestadoresFiltrados = this.prestadores;
      
      if (filtroNicho !== 'todos') {
        prestadoresFiltrados = prestadoresFiltrados.filter(p => 
          p.nicho.toLowerCase() === filtroNicho
        );
      }
      
      if (filtroNome) {
        prestadoresFiltrados = prestadoresFiltrados.filter(p => 
          p.nome.toLowerCase().includes(filtroNome)
        );
      }
      
      // Atualizar contador
      document.getElementById('contadorPrestadores').textContent = prestadoresFiltrados.length;
      
      // Calcular paginação
      this.paginacao.totalPaginas = Math.ceil(prestadoresFiltrados.length / this.paginacao.itensPorPagina);
      
      // Mostrar apenas os itens da página atual
      const inicio = (this.paginacao.paginaAtual - 1) * this.paginacao.itensPorPagina;
      const fim = inicio + this.paginacao.itensPorPagina;
      const prestadoresPagina = prestadoresFiltrados.slice(inicio, fim);
      
      // Renderizar prestadores
      prestadoresPagina.forEach(prestador => {
        const statusClass = prestador.status === 'Online' ? 'bg-success' : 'bg-secondary';
        const ratingStars = this.criarRatingStars(prestador.rating);
        
        const cardHTML = `
          <div class="col-md-6 prestador-nicho" data-nicho="${prestador.nicho}">
            <div class="card-prestador p-3 shadow-sm">
              <div class="d-flex align-items-center gap-3">
                <img src="${prestador.foto}" alt="${prestador.nome}" class="prestador-img lazyload">
                <div>
                  <h6 class="mb-0 fw-bold">${prestador.nome} <span class="badge ${statusClass} ms-2">${prestador.status}</span></h6>
                  <small class="text-muted">${prestador.nicho}</small>
                  <div class="rating-stars">
                    ${ratingStars}
                    <span class="ms-1">${prestador.rating} (${prestador.avaliacoes})</span>
                  </div>
                </div>
              </div>
              <div class="mt-3 d-flex gap-2">
                <button class="btn btn-outline-primary btn-sm flex-grow-1" 
                  onclick="PrestadorUI.mostrar(${prestador.id})"
                  aria-label="Ver perfil de ${prestador.nome}">
                  <i class="bi bi-person-lines-fill"></i> Ver Perfil
                </button>
                <button class="btn btn-warning btn-sm flex-grow-1" 
                  onclick="SolicitacaoManager.iniciarSolicitacao(${prestador.id})"
                  aria-label="Solicitar serviço com ${prestador.nome}">
                  <i class="bi bi-send"></i> Solicitar
                </button>
              </div>
            </div>
          </div>
        `;
        
        container.insertAdjacentHTML('beforeend', cardHTML);
      });
      
      // Renderizar paginação se necessário
      if (this.paginacao.totalPaginas > 1) {
        let paginacaoHTML = '';
        
        // Botão anterior
        paginacaoHTML += `
          <li class="page-item ${this.paginacao.paginaAtual === 1 ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="PrestadorUI.mudarPagina(${this.paginacao.paginaAtual - 1})" aria-label="Anterior">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>
        `;
        
        // Números das páginas
        for (let i = 1; i <= this.paginacao.totalPaginas; i++) {
          paginacaoHTML += `
            <li class="page-item ${this.paginacao.paginaAtual === i ? 'active' : ''}">
              <a class="page-link" href="#" onclick="PrestadorUI.mudarPagina(${i})">${i}</a>
            </li>
          `;
        }
        
        // Botão próximo
        paginacaoHTML += `
          <li class="page-item ${this.paginacao.paginaAtual === this.paginacao.totalPaginas ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="PrestadorUI.mudarPagina(${this.paginacao.paginaAtual + 1})" aria-label="Próximo">
              <span aria-hidden="true">&raquo;</span>
            </a>
          </li>
        `;
        
        paginacaoContainer.innerHTML = paginacaoHTML;
      }
    },
    
    // Mudar página
    mudarPagina: function(pagina) {
      if (pagina < 1 || pagina > this.paginacao.totalPaginas) return;
      
      this.paginacao.paginaAtual = pagina;
      const filtro = document.getElementById('filtroNicho').value.toLowerCase();
      const busca = document.getElementById('buscaPrestador').value.toLowerCase();
      this.renderizarLista(filtro, busca);
      
      // Rolagem suave para o topo da lista
      document.getElementById('listaPrestadoresNicho').scrollIntoView({ behavior: 'smooth' });
    },
    
    // Criar estrelas de avaliação
    criarRatingStars: function(rating) {
      let starsHTML = '';
      const fullStars = Math.floor(rating);
      const hasHalfStar = (rating % 1) >= 0.5;
      
      for (let i = 1; i <= 5; i++) {
        if (i <= fullStars) {
          starsHTML += '<i class="bi bi-star-fill"></i>';
        } else if (i === fullStars + 1 && hasHalfStar) {
          starsHTML += '<i class="bi bi-star-half"></i>';
        } else {
          starsHTML += '<i class="bi bi-star"></i>';
        }
      }
      
      return starsHTML;
    },
    
    // Mostrar modal com detalhes do prestador
    mostrar: function(idOuDados) {
      let prestador;
      
      if (typeof idOuDados === 'number') {
        prestador = this.prestadores.find(p => p.id === idOuDados);
      } else if (typeof idOuDados === 'object') {
        prestador = idOuDados;
      }
      
      if (!prestador) {
        UI.showErrorToast('Prestador não encontrado');
        return;
      }
      
      // Armazenar prestador atual para solicitação
      SolicitacaoManager.prestadorAtual = prestador;
      
      // Preencher dados do modal
      document.getElementById('prestadorNome').textContent = prestador.nome;
      document.getElementById('prestadorNicho').textContent = prestador.nicho;
      document.getElementById('prestadorFoto').src = prestador.foto;
      document.getElementById('prestadorTelefone').textContent = prestador.telefone;
      document.getElementById('prestadorEmail').textContent = prestador.email;
      document.getElementById('prestadorAvaliacoes').textContent = prestador.avaliacoes;
      document.getElementById('prestadorStatus').textContent = prestador.status;
      document.getElementById('prestadorSobre').textContent = prestador.sobre;
      
      // Ajustar classe do status
      const statusBadge = document.getElementById('prestadorStatus');
      statusBadge.className = `badge ${prestador.status === 'Online' ? 'bg-success' : 'bg-secondary'} mb-3`;
      
      // Criar estrelas de avaliação
      const ratingContainer = document.getElementById('prestadorRating');
      ratingContainer.innerHTML = this.criarRatingStars(prestador.rating) + 
        ` <span class="ms-1">${prestador.rating} (${prestador.avaliacoes})</span>`;
      
      // Mostrar avaliações (simuladas)
      const avaliacoesContainer = document.getElementById('avaliacoesPrestador');
      avaliacoesContainer.innerHTML = '';
      
      const avaliacoes = [
        { nome: 'Cliente 1', rating: 5, comentario: 'Excelente serviço, muito profissional!' },
        { nome: 'Cliente 2', rating: 4, comentario: 'Bom trabalho, cumpriu com o combinado.' }
      ];
      
      avaliacoes.forEach(avaliacao => {
        const avaliacaoHTML = `
          <div class="card mb-2">
            <div class="card-body p-2">
              <div class="d-flex justify-content-between">
                <strong>${avaliacao.nome}</strong>
                <div class="rating-stars">
                  ${this.criarRatingStars(avaliacao.rating)}
                </div>
              </div>
              <p class="mb-0">${avaliacao.comentario}</p>
            </div>
          </div>
        `;
        avaliacoesContainer.insertAdjacentHTML('beforeend', avaliacaoHTML);
      });
      
      // Mostrar modal
      const modal = new bootstrap.Modal(document.getElementById('modalPerfilPrestador'));
      modal.show();
    },
    
    // Inicializar
    init: function() {
      this.renderizarLista();
    }
  };

  /**
   * Inicialização da aplicação
   */
  document.addEventListener('DOMContentLoaded', () => {
    UI.init();
    SolicitacaoManager.init();
    PrestadorUI.init();
    
    // Carregar imagens lazy
    if ('loading' in HTMLImageElement.prototype) {
      const lazyImages = document.querySelectorAll('img.lazyload');
      lazyImages.forEach(img => {
        img.src = img.dataset.src;
      });
    } else {
      // Carregar polyfill se necessário
      const script = document.createElement('script');
      script.src = 'https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js';
      document.body.appendChild(script);
    }
  });

  /**
   * Funções globais para chamadas a partir de eventos HTML
   */
  function toggleDarkMode() {
    UI.toggleDarkMode();
  }
  
  function abrirModalPrestadorDoDetalhe() {
    UI.abrirModalPrestadorDoDetalhe();
  }

  // Variável global para a solicitação atual
  let solicitacaoAtual = null;
</script>
</body>
</html>